# 장고 모델 파헤치기

웹서비스를 만드는데 가장 중요한 부분 중 하나는

- 필요한 데이터가 무엇인지 파악하고
- 데이터를 적절한 형태로 저장하는 것이다.



데이터 CRUD

- Create (생성)
- Read (조회)
- Update (수정)
- Delete (삭제)

데이터의 **형태**와 **구조**를 처음부터 잘 잡아놔야 한다.



모델(Model)

- 장고에서 데이터 구조를 정의하고 데이터를 활용하는 부분

1. 데이터 베이스 기본 개념 + 장고 모델과의 연관성
2. 장고 마이그레이션(migration)
3. 데이터 간의 관계를 모델로 표현하는 방법
4. 모델을 통해 데이터 간의 관계를 활용하는 방법



## 데이터베이스란

컴퓨터에 체계적으로 저장되는 데이터의 모음

어플리케이션의 심장과도 같은 역할을 한다.

장고같은 ORM, DRM 등등 쓰면 직접적으로 데이터 베이스를 건들이진 않아도 DB와 관련 용어정도는 알아두는게 좋다.



### Relational Database vs Non-Relational Database

관계형 데이터 베이스와 비관계형 데이터 베이스

데이터를 테이블 형태로 저장하냐 안하냐의 차이

대략적인 정리를 하자면

- 관계형DB : 데이터의 일관성지키기가 편함. SQL을 통해 복잡한 쿼리가 가능
- NoSQL : 퍼포먼스(데이터 조회 속도) 성능과 데이터 형식의 자유도가 높음
  - 구조가 없는 데이터(unstructured date)
  - 오디오, 비디오 데이터를 저장할 때 많이 사용
- 특별한 경우가 아니면 NoSQL과 RDB랑 조회 속도 차이도 느끼기 어렵고, 데이터 일관성을 따지기가 힘들어서 RDB를 쓰는게 보통 일반적이다.



### DBMS

- Database Management System
- 데이터베이스를 관리해 주는 프로그램
- MySQL, PostgreSQL, SQLite ...등등
  - SQLite : 필수 기능만 제공하는 라이트한 데이터베이스(장고 기본 db)
  - 다른 DBMS : 더 많은 기능을 제공하나 프로그램 사이즈도 크고 셋업이 복잡함

실제 데이터베이스를 사용하려면 데이터베이스 관리 시스템이 필요하다.



### SQL

- Structured Query Language (구조화된 질의 언어)
- 데이터 베이스와 소통할 때 쓰는 언어다.



### Table

데이터 하나 : 로우(Row)

속성 하나 : 각 컬럼(column)

- 각 속성(Attribute) 또는 Field(필드)라고 부른다.

  - 데이터 타입

  - 제약 조건

- id 속성

  - 각 로우를 식별하는데 쓰이는 고윳값
  - 장고는 id 필드(컬럼)을 자동으로 만들어준다.
  - id 값은 데이터베이스가 알아서 채워준다.

- Primary Key

  - 사용자가 지정한, 로우를 식별할 수 있는 컬럼 또는 컬럼의 조합
  - 대부분의 경우 pk를 id로 함

- Foreign Key

  - 테이블과 테이블 간의 관계를 나타낼 때 쓰는 키
  - 다른 테이블의 Primary Key를 참조함
  - 관계란?
    - 일대일(1:1)
      - 유저가 프로필을 가지고 있다.
      - 한 명의 유저는 하나의 프로필을 가질 수 있고, 하나의 프로필은 한 유저에게 속해있다.
    - 일대다(1:N)
      - 유저가 리뷰를 작성한다.
      - 한 명의 유저는 여러 리뷰를 작성할 수 있지만, 하나의 리뷰는 작성자가 한명이다.
    - 다대다(M:N)
      - 유저가 리뷰를 '좋아'한다.
      - 한 명의 유저는 여러 리뷰를 좋아할 수 있고, 하나의 리뷰는 여러 유저가 좋아할 수 있다.
      - 다른 예시로는 인강을 듣는다고 할 때, 강의를 생각하면된다.
      - 한 유저는 여러 강의를 들을 수 있고, 한 강의는 여러 유저가 들을 수 있기 때문에
  - 외래키와 제약조건을 이용하면 다양한 관계를 나타낼 수 있다.
  - 장고의 경우 알아서 외래키와 제약 조건을 정의해줌



## ORM

Object-Relational Mapper

파이썬은 모든게 객체다(object) -> 이를 관계형으로 매핑시켜줌.









## 마이그레이션이란

장고 모델에 정의된 내용을 데이터베이스 테이블로 옮겨주는 과정

2-단계 프로세스로 구성된다.

### 1. 마이그레이션 파일 만들기

```bash
python manage.py makemigrations
```

`models.py`에서 생성된 내용이나 변경된 내용을 `000X_changes.py`같은 파일에 기록해 둔다.

`000X_changes.py`를 마이그레이션 파일이라고 하는데 APP안에 `migrations`폴더 안에 생성된다.



### 2. 마이그레이션 파일 적용하기

```bash
python manage.py migrate
```

명령을 실행시 ORM이 migrations폴더안에 파일을 실행해서 SQL로 변환해주고 데이터베이스에 반영시켜준다.



`makemigrations`는 파일만 만들고 DB에 적용은 `migrate`명령어가 하는 것이다.



마이그레이션 파일은 모델에 대한 스냅샷의 개념으로도 볼 수 있다.

- 모델 히스토리를 파악할 수 있음
- 예전 모델 버전으로 되돌릴 수 있음



마이그레이션은 앱(APP)단위로 관리된다.



